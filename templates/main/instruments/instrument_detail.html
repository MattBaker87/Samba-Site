{% extends "main/base_new.html" %}

{% block title %}Instrument detail{% endblock %}

{% block heading %}Instrument details for '{{ instrument.name }}'{% endblock %}

{% block sub-nav %}
    {% load get_instruments %}
    {% get_instruments as instrument_list %}
    <table class="condensed-table dimmed">
        <thead>
            <tr>
                <th colspan="2">All instruments</th>
            </tr>
        </thead>
        <tbody>
            {% for item in instrument_list %}
                <tr {% if item == instrument %}class="highlighted"{% endif %}>
                    <td><a href="{{ item.get_absolute_url }}">{{ item.name }}</a></td>
                    <td>{% if item.damaged %}<span class="label important">Damaged</span>{% endif %}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block content %}
    <p><b>Name:</b> {{ instrument.name }}</p>
    <p><b>Type:</b> {{ instrument.get_instrument_type_display }}</p>
    {% if instrument.damaged %}
        <p><b>Damage:</b> This instrument is flagged as damaged</p>
    {% endif %}
    <p><b>Location:</b> {{ instrument.location }}</p>
    <p><b>Last user:</b> {% if instrument.last_booking %}{{ instrument.last_booking.user.get_profile.name }}{% else %}Brand new!{% endif %}</p>
    <p><b>Next booking:</b> {% if instrument.next_booking %}{{ instrument.next_booking.event.when }}{% else %}No future bookings{% endif %}</p>
    <p><b>Notes:</b> TODO - add most recent note here</p>
    {% if instrument.past_bookings %}
        <p><b>Instrument history:</b></p>
        <table>
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Player</th>
                    <th>Notes when returned</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in instrument.past_bookings %}
                    <tr>
                        <td>{{ booking.event.name }}</td>
                        <td>{{ booking.event.when }}</td>
                        <td>{{ booking.user.get_profile.name }}</td>
                        <td>TODO: add notes</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}

{% block options %}
    <p><a href="{{ instrument.get_delete_url }}" class="btn danger">Delete instrument</a></p>
    <p><a href="{{ instrument.get_delete_url }}" class="btn info">Edit instrument</a></p>
    <p><a href="{{ instrument.get_delete_url }}" class="btn success">Sign instrument in</a></p>
{% endblock %}

{% block bottom %}
    <br>
    <ul class="breadcrumb">
    	<li>
    		<a href="{% url home %}">Home</a>
    		<span class="divider">/</span>
    	</li>
    	<li>
    	    <a href="{% url instrument_list %}">Instruments</a>
    	    <span class="divider">/</span>
    	</li>
    	<li class="active">
    		<a href="#">{{ instrument.name }}</a>
    	</li>
    </ul>
{% endblock %}

{% block wireframe_content %}
    <ul>
        <li>TODO at next opportunity:
            <ul>
                <li>Add breadcrumbs to bottom of page to make it easier to navigate</li>
                <li>Add link back to instrument list to the options bar on the right</li>
                <li>Fix CSS of buttons on the right so that they're all the same size, and so that tops of columns align nicely</li>
            </ul>
        </li>
        <li>TODO after adding event functionality:
            <ul>
                <li>Check the display table of past events the instrument has been to is working (currently not showing as there are no events in the system!)</li>
                <li>Add pagination to the above list of past events, or limit them to the last 10</li>
                <li>Add sign instrument in functionality</li>
                <li>Add edit instrument functionality (for admin)</li>
                <li>Add ability to make notes, and figure out a sensible way of displaying them alongside events</li>
            </ul>
        </li>
        <li>TODO lower priority:
            <ul>
                <li>Build admin distinction, so buttons aren't shown to everyone</li>
            </ul>
        </li>
    </ul>
{% endblock %}

{% block wireframe_links %}
    <ul>
        <li><span class="label notice">Admin</span> <a href="#">Delete instrument</a></li>
        <li><span class="label notice">Admin</span> <a href="{% url instrument_edit %}">Edit instrument flag and details</a></li>
        <li><a href="{% url instrument_signin %}">Sign instrument back in</a></li>
        <li><a href="{% url instrument_list %}">Back to list of instruments</a></li>
        <li><a href="{% url home %}">Back to homepage</a></li>
        <li><a href="{% url logout %}">Logout</a></li>
    </ul>
{% endblock %}